---
import BaseLayout from "../../layouts/BaseLayout.astro";
import JsonLd from "../../components/JsonLd.astro";

/**
 * ダミーの Place 一覧（実運用ではAPI/DBに差し替え）
 * - name / address / geo を極力埋めると評価が安定します
 */
const places = [
  {
    id: "pl-001",
    name: "木場公園 バスケットコート",
    streetAddress: "木場公園",
    addressLocality: "江東区",
    addressRegion: "東京都",
    postalCode: "135-0023",
    addressCountry: "JP",
    latitude: 35.669,
    longitude: 139.814,
    note: "朝活ラン＆軽運動に最適。集合場所として利用。"
  },
  {
    id: "pl-002",
    name: "江東区スポーツセンター",
    streetAddress: "東京都江東区北砂1-2-9",
    addressLocality: "江東区",
    addressRegion: "東京都",
    postalCode: "136-0073",
    addressCountry: "JP",
    latitude: 35.680,
    longitude: 139.824,
    note: "屋内バスケットコート有。週末の個人参加に人気。"
  },
  {
    id: "pl-003",
    name: "清澄白河 カフェラウンジ",
    streetAddress: "清澄白河駅周辺",
    addressLocality: "江東区",
    addressRegion: "東京都",
    postalCode: "135-0021",
    addressCountry: "JP",
    latitude: 35.680,
    longitude: 139.799,
    note: "英会話ゆるカフェ会の定番スポット。"
  }
];

/** メタ */
const pageTitle = "開催場所一覧 | MinnaCircle";
const pageDesc  = "MinnaCircleの主な開催場所一覧。公園・体育館・カフェなどの集合場所情報。";

/** サイトOrigin（astro.configのsiteがあれば使用） */
const siteOrigin = (Astro.site && Astro.site.href) ? Astro.site.href.replace(/\/$/, "") : "";

/** ItemList(JSON-LD) を生成（各 item は Place を指すURLを持つ） */
const itemListLd = {
  "@context": "https://schema.org",
  "@type": "ItemList",
  "name": "MinnaCircle Places",
  "itemListElement": places.map((p, i) => ({
    "@type": "ListItem",
    "position": i + 1,
    "name": p.name,
    ...(siteOrigin ? { "url": `${siteOrigin}/places/${p.id}` } : {}),
    "item": {
      "@type": "Place",
      "name": p.name,
      "address": {
        "@type": "PostalAddress",
        "streetAddress": p.streetAddress,
        "addressLocality": p.addressLocality,
        "addressRegion": p.addressRegion,
        "postalCode": p.postalCode,
        "addressCountry": p.addressCountry
      },
      "geo": {
        "@type": "GeoCoordinates",
        "latitude": p.latitude,
        "longitude": p.longitude
      }
    }
  }))
};
---

<BaseLayout title={pageTitle} lang="ja" description={pageDesc}>
  <!-- JSON-LD: ItemList(Place) -->
  <JsonLd data={itemListLd} />

  <section class="max-w-6xl mx-auto px-4 py-8 md:py-12">
    <h1 class="text-2xl md:text-3xl font-extrabold mb-6">開催場所一覧</h1>

    <!-- ナビ -->
    <div class="mb-6 flex flex-wrap gap-3 text-sm">
      <a href="/search?type=place" class="px-4 py-2 rounded-xl border hover:bg-gray-50">場所で検索する</a>
      <a href="/events" class="px-4 py-2 rounded-xl border hover:bg-gray-50">イベント一覧へ</a>
    </div>

    <!-- グリッド -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      {places.map((p) => (
        <a href={`/places/${p.id}`} class="block bg-white rounded-2xl shadow hover:shadow-md transition">
          <div class="rounded-t-2xl w-full h-40 bg-gray-100 flex items-center justify-center text-gray-400 text-sm">
            Place
          </div>
          <div class="p-4">
            <h2 class="font-bold line-clamp-2">{p.name}</h2>
            <p class="text-sm text-gray-600 mt-1 line-clamp-2">{p.note}</p>
            <div class="mt-2 text-xs text-gray-500 space-y-1">
              <div>📍 {p.addressRegion}{p.addressLocality} / {p.streetAddress}</div>
              <div>🧭 {p.latitude}, {p.longitude}</div>
            </div>
          </div>
        </a>
      ))}
    </div>
  </section>
</BaseLayout>
