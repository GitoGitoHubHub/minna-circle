---
import BaseLayout from "../../layouts/BaseLayout.astro";

/**
 * ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆä¸€è¦§ã‚„ãƒˆãƒƒãƒ—ã® featuredCircles ã¨æ•´åˆï¼‰
 * å®Ÿãƒ‡ãƒ¼ã‚¿æ¥ç¶šæ™‚ã¯ API/DB å–å¾—ï¼‹ getStaticPaths ã«å·®ã—æ›¿ãˆã€‚
 */
const allCircles = [
  {
    id: "cl-001",
    name: "ãƒŸãƒ³ãƒŠã§ãƒã‚¹ã‚±",
    intro: "åˆå¿ƒè€…ï½çµŒé¨“è€…ã¾ã§å¹…åºƒãã€‚è©¦åˆã‚ˆã‚Šäº¤æµé‡è¦–ï¼é€±æœ«ã«æ±Ÿæ±åŒºãƒ»å¢¨ç”°åŒºã§æ´»å‹•ã—ã¦ã„ã¾ã™ã€‚",
    image: "/og.png",
    memberCount: 42,
    areaText: "æ±Ÿæ±åŒºãƒ»å¢¨ç”°åŒº",
    isPickup: true,
    tags: ["ãƒã‚¹ã‚±","äº¤æµ","åˆå¿ƒè€…æ­“è¿"],
    contactEmail: "basket@example.com",
    website: "",
    createdAt: "2025-08-05T12:00:00+09:00"
  },
  {
    id: "cl-002",
    name: "æ¸…æ¾„ã‚³ãƒ¼ãƒ’ãƒ¼å·¡ã‚Šéƒ¨",
    intro: "é€±ä¸€ã§ã‚³ãƒ¼ãƒ’ãƒ¼åº—ã‚’æ¢è¨ªã€‚è±†çŸ¥è­˜ã‚’æ°—è»½ã«å…±æœ‰ã—ãªãŒã‚‰ã€ã‚«ãƒ•ã‚§æ–‡åŒ–ã‚’æ¥½ã—ã‚€ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã§ã™ã€‚",
    image: "/og.png",
    memberCount: 18,
    areaText: "æ¸…æ¾„ç™½æ²³ãƒ»é–€å‰ä»²ç”º",
    isPickup: false,
    tags: ["ã‚«ãƒ•ã‚§","æ•£ç­–"],
    contactEmail: "coffee@example.com",
    website: "",
    createdAt: "2025-08-15T09:00:00+09:00"
  },
  {
    id: "cl-003",
    name: "è¦ªå­ã§å¤–éŠã³",
    intro: "å°ã•ãªãŠå­ã•ã‚“æ­“è¿ã€‚æ°´éŠã³ãƒ»å…¬åœ’ãƒ”ã‚¯ãƒ‹ãƒƒã‚¯ãªã©ã€ã‚†ã‚‹ãæ¥½ã—ãå±‹å¤–ã§äº¤æµã—ã¾ã™ã€‚",
    image: "/og.png",
    memberCount: 27,
    areaText: "æ±é™½ç”ºãƒ»æœ‰æ˜",
    isPickup: false,
    tags: ["è¦ªå­OK","å…¬åœ’","ã‚¢ã‚¦ãƒˆãƒ‰ã‚¢"],
    contactEmail: "family@example.com",
    website: "",
    createdAt: "2025-08-08T09:00:00+09:00"
  }
];

/** ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
const { id } = Astro.params;

/** æœ¬æ¥ã¯API/DBã‹ã‚‰å–å¾— */
const circle = allCircles.find((c) => c.id === id);
if (!circle) {
  throw Astro.redirect("/404");
}

/** ãƒ¡ã‚¿ */
const pageTitle = `${circle.name} | MinnaCircle`;
const pageDesc  = circle.intro;

/** ã‚µã‚¤ãƒˆURLï¼ˆastro.configã®siteãŒã‚ã‚Œã°ä½¿ç”¨ï¼‰ */
const siteUrl = (Astro.site && Astro.site.href) ? Astro.site.href.replace(/\/$/, "") : "";

/** JSON-LD: Organization */
const orgLd = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": circle.name,
  "description": circle.intro,
  ...(siteUrl ? { "url": `${siteUrl}/circles/${circle.id}` } : {}),
  "logo": circle.image,
  "areaServed": circle.areaText,
  "numberOfEmployees": circle.memberCount, // ä¾¿å®œçš„ã«ãƒ¡ãƒ³ãƒãƒ¼æ•°ã‚’åæ˜ 
  "contactPoint": [
    {
      "@type": "ContactPoint",
      "contactType": "customer support",
      "email": circle.contactEmail,
      "availableLanguage": ["Japanese", "English", "Chinese"]
    }
  ]
};

/** JSON-LD: ãƒ‘ãƒ³ããš */
const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home",    ...(siteUrl ? { "item": siteUrl } : {}) },
    { "@type": "ListItem", "position": 2, "name": "Circles", ...(siteUrl ? { "item": `${siteUrl}/circles` } : {}) },
    { "@type": "ListItem", "position": 3, "name": circle.name, ...(siteUrl ? { "item": `${siteUrl}/circles/${circle.id}` } : {}) }
  ]
};
---

<BaseLayout title={pageTitle} lang="ja" meta_description={pageDesc}>
  <!-- JSON-LD -->
  <script type="application/ld+json">{JSON.stringify(orgLd)}</script>
  <script type="application/ld+json">{JSON.stringify(breadcrumbLd)}</script>

  <section class="max-w-5xl mx-auto px-4 py-8 md:py-12">
    <!-- ãƒ‘ãƒ³ããš / ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="mb-6">
      <nav class="text-xs text-gray-500 mb-2">
        <a class="hover:underline" href="/">Home</a> /
        <a class="hover:underline" href="/circles">Circles</a> /
        <span>{circle.name}</span>
      </nav>
      <h1 class="text-2xl md:text-4xl font-extrabold">{circle.name}</h1>
      <div class="mt-2 flex flex-wrap gap-2 text-sm text-gray-600">
        <span>ğŸ“ æ´»å‹•ã‚¨ãƒªã‚¢: {circle.areaText}</span>
        <span>ãƒ»ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼: {circle.memberCount}å</span>
        {circle.isPickup && <span class="px-2 py-0.5 bg-indigo-600 text-white rounded-full text-xs">ãƒ”ãƒƒã‚¯ã‚¢ãƒƒãƒ—</span>}
      </div>
      <div class="mt-2 flex flex-wrap gap-2">
        {circle.tags?.map((t) => <span class="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs">{t}</span>)}
      </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ 2ã‚«ãƒ©ãƒ  -->
    <div class="grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-6">
      <!-- å·¦ï¼šæ¦‚è¦ -->
      <article class="bg-white rounded-2xl shadow p-5 md:p-7">
        <img src={circle.image} alt={circle.name} class="rounded-xl w-full h-56 object-cover mb-4" loading="lazy" />
        <h2 class="text-lg md:text-xl font-bold mb-2">ã‚µãƒ¼ã‚¯ãƒ«æ¦‚è¦</h2>
        <p class="text-gray-700 leading-relaxed">{circle.intro}</p>

        <h3 class="mt-6 font-semibold">æ´»å‹•æƒ…å ±</h3>
        <ul class="mt-2 text-sm text-gray-700 space-y-1">
          <li>ğŸ“ ã‚¨ãƒªã‚¢: {circle.areaText}</li>
          <li>ğŸ‘¥ ãƒ¡ãƒ³ãƒãƒ¼: {circle.memberCount}å</li>
          <li>ğŸ·ï¸ ã‚¿ã‚°: {circle.tags?.join(" / ")}</li>
          <li>ğŸ“§ é€£çµ¡å…ˆ: {circle.contactEmail}</li>
          {circle.website && <li>ğŸ”— ã‚µã‚¤ãƒˆ: <a class="text-indigo-700 underline" href={circle.website} rel="noopener">å¤–éƒ¨ã‚µã‚¤ãƒˆ</a></li>}
        </ul>

        <div class="mt-6 flex gap-3">
          <a href={`/search?type=event&q=${encodeURIComponent(circle.tags?.[0] ?? "")}`} class="bg-indigo-600 text-white px-5 py-2 rounded-xl shadow hover:bg-indigo-700 transition">
            é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¢ã™
          </a>
          <a href="/search?type=circle" class="px-5 py-2 rounded-xl border hover:bg-gray-50 transition">ä»–ã®ã‚µãƒ¼ã‚¯ãƒ«ã‚’è¦‹ã‚‹</a>
        </div>
      </article>

      <!-- å³ï¼šæ¡ˆå†…/ãƒ«ãƒ¼ãƒ« -->
      <aside class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="font-semibold mb-2">å‚åŠ ãƒ«ãƒ¼ãƒ«</h3>
          <ul class="text-sm text-gray-700 list-disc pl-5 space-y-1">
            <li>åˆå¿ƒè€…æ­“è¿ãƒ»çµŒé¨“ä¸å•ï¼ˆå®‰å…¨ç¬¬ä¸€ã§ãŠé¡˜ã„ã—ã¾ã™ï¼‰ã€‚</li>
            <li>æœªæˆå¹´ã¯ä¿è­·è€…ã®åŒæ„ãŒå¿…è¦ã§ã™ã€‚</li>
            <li>è¿·æƒ‘è¡Œç‚ºãƒ»å‹§èª˜ã¯å³ç¦ã€‚é‹å–¶åˆ¤æ–­ã§å‚åŠ ã‚’ãŠæ–­ã‚Šã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚</li>
          </ul>
        </div>

        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="font-semibold mb-2">å•ã„åˆã‚ã›</h3>
          <p class="text-sm text-gray-700">
            ã‚µãƒ¼ã‚¯ãƒ«ã¸ã®é€£çµ¡ã¯ <a class="text-indigo-700 underline" href="/contact">/contact</a> ã‹ã‚‰ã€ä»¶åã«ã‚µãƒ¼ã‚¯ãƒ«åã‚’è¨˜è¼‰ã®ã†ãˆãŠé€ã‚Šãã ã•ã„ã€‚
          </p>
        </div>

        <a href="/" class="block text-center text-indigo-700 underline">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
      </aside>
    </div>
  </section>
</BaseLayout>
