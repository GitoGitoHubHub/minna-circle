---
import BaseLayout from "../../layouts/BaseLayout.astro";
import JsonLd from "../../components/JsonLd.astro";
import { buildPlace } from "../../lib/schema";

/**
 * ãƒ€ãƒŸãƒ¼ã® Place ä¸€è¦§ï¼ˆ/places/index.astro ã¨æ•´åˆï¼‰
 * å®Ÿé‹ç”¨ã§ã¯ API/DB ã«å·®ã—æ›¿ãˆã€getStaticPaths ã§å‹•çš„ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
 */
const places = [
  {
    id: "pl-001",
    name: "æœ¨å ´å…¬åœ’ ãƒã‚¹ã‚±ãƒƒãƒˆã‚³ãƒ¼ãƒˆ",
    streetAddress: "æœ¨å ´å…¬åœ’",
    addressLocality: "æ±Ÿæ±åŒº",
    addressRegion: "æ±äº¬éƒ½",
    postalCode: "135-0023",
    addressCountry: "JP",
    latitude: 35.669,
    longitude: 139.814,
    note: "æœæ´»ãƒ©ãƒ³ï¼†è»½é‹å‹•ã«æœ€é©ã€‚é›†åˆå ´æ‰€ã¨ã—ã¦åˆ©ç”¨ã€‚"
  },
  {
    id: "pl-002",
    name: "æ±Ÿæ±åŒºã‚¹ãƒãƒ¼ãƒ„ã‚»ãƒ³ã‚¿ãƒ¼",
    streetAddress: "æ±äº¬éƒ½æ±Ÿæ±åŒºåŒ—ç ‚1-2-9",
    addressLocality: "æ±Ÿæ±åŒº",
    addressRegion: "æ±äº¬éƒ½",
    postalCode: "136-0073",
    addressCountry: "JP",
    latitude: 35.680,
    longitude: 139.824,
    note: "å±‹å†…ãƒã‚¹ã‚±ãƒƒãƒˆã‚³ãƒ¼ãƒˆæœ‰ã€‚é€±æœ«ã®å€‹äººå‚åŠ ã«äººæ°—ã€‚"
  },
  {
    id: "pl-003",
    name: "æ¸…æ¾„ç™½æ²³ ã‚«ãƒ•ã‚§ãƒ©ã‚¦ãƒ³ã‚¸",
    streetAddress: "æ¸…æ¾„ç™½æ²³é§…å‘¨è¾º",
    addressLocality: "æ±Ÿæ±åŒº",
    addressRegion: "æ±äº¬éƒ½",
    postalCode: "135-0021",
    addressCountry: "JP",
    latitude: 35.680,
    longitude: 139.799,
    note: "è‹±ä¼šè©±ã‚†ã‚‹ã‚«ãƒ•ã‚§ä¼šã®å®šç•ªã‚¹ãƒãƒƒãƒˆã€‚"
  }
];

/** ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
const { id } = Astro.params;

/** å¯¾è±¡ Place ã‚’å–å¾—ï¼ˆãªã‘ã‚Œã° 404ï¼‰ */
const place = places.find((p) => p.id === id);
if (!place) {
  throw Astro.redirect("/404");
}

/** ãƒ¡ã‚¿ */
const pageTitle = `${place.name} | MinnaCircle`;
const pageDesc  = place.note ?? `${place.addressRegion}${place.addressLocality}ã®é–‹å‚¬å ´æ‰€æƒ…å ±`;

/** ã‚µã‚¤ãƒˆOriginï¼ˆastro.configã®siteãŒã‚ã‚Œã°ä½¿ç”¨ï¼‰ */
const siteOrigin = (Astro.site && Astro.site.href) ? Astro.site.href.replace(/\/$/, "") : "";

/** JSON-LD: Place */
const placeLd = buildPlace({
  name: place.name,
  streetAddress: place.streetAddress,
  addressLocality: place.addressLocality,
  addressRegion: place.addressRegion,
  postalCode: place.postalCode,
  addressCountry: place.addressCountry,
  latitude: place.latitude,
  longitude: place.longitude,
});

/** JSON-LD: ãƒ‘ãƒ³ããš */
const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      ...(siteOrigin ? { "item": siteOrigin } : {})
    },
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Places",
      ...(siteOrigin ? { "item": `${siteOrigin}/places` } : {})
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": place.name,
      ...(siteOrigin ? { "item": `${siteOrigin}/places/${place.id}` } : {})
    }
  ]
};
---

<BaseLayout title={pageTitle} lang="ja" description={pageDesc}>
  <!-- JSON-LD: Place / Breadcrumb -->
  <JsonLd data={[placeLd, breadcrumbLd]} />

  <section class="max-w-5xl mx-auto px-4 py-8 md:py-12">
    <!-- ãƒ‘ãƒ³ããš / ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="mb-6">
      <nav class="text-xs text-gray-500 mb-2">
        <a class="hover:underline" href="/">Home</a> / <a class="hover:underline" href="/places">Places</a> / <span>{place.name}</span>
      </nav>
      <h1 class="text-2xl md:text-4xl font-extrabold">{place.name}</h1>
      <div class="mt-2 text-sm text-gray-600 space-y-1">
        <div>ğŸ“ {place.addressRegion}{place.addressLocality} / {place.streetAddress}</div>
        <div>ğŸ§­ {place.latitude}, {place.longitude}</div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-6">
      <!-- ãƒ¡ã‚¤ãƒ³ -->
      <article class="bg-white rounded-2xl shadow p-5 md:p-7">
        <div class="rounded-xl w-full h-56 bg-gray-100 flex items-center justify-center text-gray-400 text-sm mb-4">
          Place
        </div>

        <h2 class="text-lg md:text-xl font-bold mb-2">å ´æ‰€æ¦‚è¦</h2>
        <p class="text-gray-700 leading-relaxed">{place.note ?? "ã“ã®å ´æ‰€ã®æ¦‚è¦æƒ…å ±ã§ã™ã€‚"}</p>

        <h3 class="mt-6 font-semibold">æ‰€åœ¨åœ°</h3>
        <ul class="mt-2 text-sm text-gray-700 space-y-1">
          <li>ä½æ‰€: {place.addressRegion}{place.addressLocality} {place.streetAddress}</li>
          <li>éƒµä¾¿ç•ªå·: {place.postalCode}</li>
          <li>å›½: {place.addressCountry}</li>
          <li>ç·¯åº¦/çµŒåº¦: {place.latitude}, {place.longitude}</li>
        </ul>

        <div class="mt-6 flex gap-3">
          <a href="/events" class="px-5 py-2 rounded-xl border hover:bg-gray-50 transition">ã“ã®å ´æ‰€ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¢ã™</a>
          <a href="/places" class="px-5 py-2 rounded-xl border hover:bg-gray-50 transition">å ´æ‰€ä¸€è¦§ã¸æˆ»ã‚‹</a>
        </div>
      </article>

      <!-- ã‚µã‚¤ãƒ‰ -->
      <aside class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="font-semibold mb-2">è£œè¶³æƒ…å ±</h3>
          <ul class="text-sm text-gray-700 list-disc pl-5 space-y-1">
            <li>é›†åˆå ´æ‰€ã®è©³ç´°ã¯ã‚¤ãƒ™ãƒ³ãƒˆå‹Ÿé›†ãƒšãƒ¼ã‚¸ã‚’ã”ç¢ºèªãã ã•ã„ã€‚</li>
            <li>å…¬å…±äº¤é€šæ©Ÿé–¢ã®åˆ©ç”¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚</li>
            <li>æ–½è¨­ã®ãƒ«ãƒ¼ãƒ«ã«å¾“ã„ã€ãƒãƒŠãƒ¼ã‚ã‚‹åˆ©ç”¨ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚</li>
          </ul>
        </div>

        <a href="/" class="block text-center text-indigo-700 underline">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
      </aside>
    </div>
  </section>
</BaseLayout>
