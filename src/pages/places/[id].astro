---
import BaseLayout from "../../layouts/BaseLayout.astro";

/**
 * ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
 *  - æ—¢å­˜ã®ã‚¤ãƒ™ãƒ³ãƒˆä¾‹ã¨æ•´åˆã™ã‚‹ã‚ˆã†ã€æœ¨å ´å…¬åœ’ãƒ»æ±Ÿæ±åŒºã‚¹ãƒãƒ¼ãƒ„ã‚»ãƒ³ã‚¿ãƒ¼ãƒ»æ¸…æ¾„ç™½æ²³ã‚’ç”¨æ„
 *  - å®Ÿãƒ‡ãƒ¼ã‚¿æ¥ç¶šæ™‚ã¯ API/DB å–å¾—ï¼‹ getStaticPaths ã«å·®ã—æ›¿ãˆ
 */
const allPlaces = [
  {
    id: "pl-kiba-park",
    name: "æœ¨å ´å…¬åœ’",
    areaText: "æ±Ÿæ±åŒº",
    address: "æ±äº¬éƒ½æ±Ÿæ±åŒºæœ¨å ´",
    description: "ç·‘ãŒå¤šãã€ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã‚„ã‚¹ãƒˆãƒ¬ãƒƒãƒã«æœ€é©ãªéƒ½ç«‹å…¬åœ’ã€‚æœæ´»ã‚¤ãƒ™ãƒ³ãƒˆã®å®šç•ªã‚¹ãƒãƒƒãƒˆã€‚",
    image: "/og.png",
    amenities: ["ãƒˆã‚¤ãƒ¬", "ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã‚³ãƒ¼ã‚¹", "ãƒ™ãƒ³ãƒ", "è‡ªè²©æ©Ÿ"],
    openingHours: "06:00-21:00",
    telephone: "",
    url: "",
    relatedEvents: [
      { id: "ev-001", title: "æœæ´»ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ï¼ æœ¨å ´å…¬åœ’", dateText: "2025-09-01 07:00" }
    ]
  },
  {
    id: "pl-koto-sports",
    name: "æ±Ÿæ±åŒºã‚¹ãƒãƒ¼ãƒ„ã‚»ãƒ³ã‚¿ãƒ¼",
    areaText: "æ±Ÿæ±åŒº",
    address: "æ±äº¬éƒ½æ±Ÿæ±åŒºåŒ—ç ‚1-2-9",
    description: "ã‚¢ãƒªãƒ¼ãƒŠãƒ»å¤šç›®çš„å®¤ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å®¤ãªã©ã‚’å‚™ãˆã‚‹å…¬å…±ã‚¹ãƒãƒ¼ãƒ„æ–½è¨­ã€‚",
    image: "/og.png",
    amenities: ["æ›´è¡£å®¤", "ã‚·ãƒ£ãƒ¯ãƒ¼", "ãƒ­ãƒƒã‚«ãƒ¼", "é§è¼ªå ´"],
    openingHours: "09:00-22:00",
    telephone: "03-XXXX-XXXX",
    url: "",
    relatedEvents: [
      { id: "ev-002", title: "é€±æœ«ãƒã‚¹ã‚±å€‹äººå‚åŠ ", dateText: "2025-09-06 18:00" }
    ]
  },
  {
    id: "pl-kiyosumi",
    name: "æ¸…æ¾„ç™½æ²³",
    areaText: "æ±Ÿæ±åŒº",
    address: "æ±äº¬éƒ½æ±Ÿæ±åŒºæ¸…æ¾„ãƒ»ç™½æ²³ã‚¨ãƒªã‚¢",
    description: "ã‚³ãƒ¼ãƒ’ãƒ¼ã‚«ãƒ«ãƒãƒ£ãƒ¼ã§æœ‰åãªã‚¨ãƒªã‚¢ã€‚ã‚«ãƒ•ã‚§ä¼šã‚„è‹±ä¼šè©±ãƒŸãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãŒäººæ°—ã€‚",
    image: "/og.png",
    amenities: ["ã‚«ãƒ•ã‚§å¤šæ•°", "å…¬åœ’", "ã‚®ãƒ£ãƒ©ãƒªãƒ¼"],
    openingHours: "",
    telephone: "",
    url: "",
    relatedEvents: [
      { id: "ev-003", title: "è‹±ä¼šè©±ã‚†ã‚‹ã‚«ãƒ•ã‚§ä¼š", dateText: "2025-09-07 10:00" }
    ]
  }
];

/** ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ */
const { id } = Astro.params;

/** æœ¬æ¥ã¯API/DBã‹ã‚‰å–å¾— */
const place = allPlaces.find((p) => p.id === id);
if (!place) {
  throw Astro.redirect("/404");
}

/** ãƒ¡ã‚¿ */
const pageTitle = `${place.name} | MinnaCircle`;
const pageDesc  = place.description ?? `${place.name} ã®ä¼šå ´æƒ…å ±`;

/** ã‚µã‚¤ãƒˆURLï¼ˆastro.configã®siteãŒã‚ã‚Œã°ä½¿ç”¨ï¼‰ */
const siteUrl = (Astro.site && Astro.site.href) ? Astro.site.href.replace(/\/$/, "") : "";

/** JSON-LD: Place */
const placeLd = {
  "@context": "https://schema.org",
  "@type": "Place",
  "name": place.name,
  "description": place.description,
  ...(siteUrl ? { "url": `${siteUrl}/places/${place.id}` } : {}),
  "image": place.image,
  "address": {
    "@type": "PostalAddress",
    "streetAddress": place.address,
    "addressLocality": place.areaText,
    "addressCountry": "JP"
  },
  ...(place.telephone ? { "telephone": place.telephone } : {}),
  ...(place.openingHours ? { "openingHours": place.openingHours } : {})
};

/** JSON-LD: ãƒ‘ãƒ³ããš */
const breadcrumbLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    { "@type": "ListItem", "position": 1, "name": "Home",    ...(siteUrl ? { "item": siteUrl } : {}) },
    { "@type": "ListItem", "position": 2, "name": "Places",  ...(siteUrl ? { "item": `${siteUrl}/places` } : {}) },
    { "@type": "ListItem", "position": 3, "name": place.name, ...(siteUrl ? { "item": `${siteUrl}/places/${place.id}` } : {}) }
  ]
};
---

<BaseLayout title={pageTitle} lang="ja" meta_description={pageDesc}>
  <!-- JSON-LD -->
  <script type="application/ld+json">{JSON.stringify(placeLd)}</script>
  <script type="application/ld+json">{JSON.stringify(breadcrumbLd)}</script>

  <section class="max-w-5xl mx-auto px-4 py-8 md:py-12">
    <!-- ãƒ‘ãƒ³ããš / ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="mb-6">
      <nav class="text-xs text-gray-500 mb-2">
        <a class="hover:underline" href="/">Home</a> /
        <a class="hover:underline" href="/places">Places</a> /
        <span>{place.name}</span>
      </nav>
      <h1 class="text-2xl md:text-4xl font-extrabold">{place.name}</h1>
      <div class="mt-2 flex flex-wrap gap-2 text-sm text-gray-600">
        <span>ğŸ“ ã‚¨ãƒªã‚¢: {place.areaText}</span>
        {place.openingHours && <span>ãƒ»ğŸ•˜ å–¶æ¥­æ™‚é–“: {place.openingHours}</span>}
        {place.telephone && <span>ãƒ»ğŸ“ {place.telephone}</span>}
      </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ 2ã‚«ãƒ©ãƒ  -->
    <div class="grid grid-cols-1 md:grid-cols-[2fr_1fr] gap-6">
      <!-- å·¦ï¼šä¼šå ´æƒ…å ± -->
      <article class="bg-white rounded-2xl shadow p-5 md:p-7">
        <img src={place.image} alt={place.name} class="rounded-xl w-full h-56 object-cover mb-4" loading="lazy" />

        <h2 class="text-lg md:text-xl font-bold mb-2">æ¦‚è¦</h2>
        <p class="text-gray-700 leading-relaxed">{place.description}</p>

        <h3 class="mt-6 font-semibold">æ‰€åœ¨åœ°</h3>
        <p class="text-sm text-gray-700">{place.address}</p>

        {place.amenities?.length > 0 && (
          <>
            <h3 class="mt-6 font-semibold">è¨­å‚™ãƒ»ç‰¹å¾´</h3>
            <div class="mt-2 flex flex-wrap gap-2">
              {place.amenities.map((a) => (
                <span class="px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs">{a}</span>
              ))}
            </div>
          </>
        )}

        <div class="mt-6 flex gap-3">
          <a href="/search?type=event&q=%E6%B1%9F%E6%9D%B1%E5%8C%BA" class="bg-indigo-600 text-white px-5 py-2 rounded-xl shadow hover:bg-indigo-700 transition">
            ã“ã®ã‚¨ãƒªã‚¢ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¢ã™
          </a>
          <a href="/search?type=circle" class="px-5 py-2 rounded-xl border hover:bg-gray-50 transition">
            ã‚µãƒ¼ã‚¯ãƒ«ä¸€è¦§ã‚’è¦‹ã‚‹
          </a>
        </div>
      </article>

      <!-- å³ï¼šé–¢é€£æƒ…å ± -->
      <aside class="space-y-4">
        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="font-semibold mb-2">é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆ</h3>
          {place.relatedEvents?.length > 0 ? (
            <ul class="text-sm text-indigo-700 space-y-2">
              {place.relatedEvents.map((ev) => (
                <li>
                  <a class="underline" href={`/events/${ev.id}`}>{ev.title}</a>
                  <span class="text-gray-500 ml-2">{ev.dateText}</span>
                </li>
              ))}
            </ul>
          ) : (
            <p class="text-sm text-gray-600">é–¢é€£ã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          )}
        </div>

        <div class="bg-white rounded-2xl shadow p-5">
          <h3 class="font-semibold mb-2">å¤–éƒ¨ãƒªãƒ³ã‚¯</h3>
          {place.url ? (
            <a class="text-indigo-700 underline text-sm" href={place.url} rel="noopener">å…¬å¼ã‚µã‚¤ãƒˆ</a>
          ) : (
            <p class="text-sm text-gray-600">å…¬å¼ã‚µã‚¤ãƒˆæƒ…å ±ã¯æœªç™»éŒ²ã§ã™ã€‚</p>
          )}
        </div>

        <a href="/" class="block text-center text-indigo-700 underline">ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
      </aside>
    </div>
  </section>
</BaseLayout>
